// undefined v1.0.0 Copyright 2019 undefined
!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-contour"),require("@turf/intersect")):"function"==typeof define&&define.amd?define(["exports","d3-contour","@turf/intersect"],e):e(r.freegis=r.freegis||{},r.d3,r.intersect)}(this,function(r,e,t){"use strict";function o(r,e){var t,o=[0].rep(e*e);for(t=0;t<e;t++)o[t*e+t]=r;return o}function n(r,e,t,o){var n,a,i=Array(t*o);for(n=0;n<t;n++)for(a=0;a<o;a++)i[n*o+a]=r[n*o+a]+e[n*o+a];return i}function a(r,e,t,o,n){var a,i,f,u=Array(t*n);for(a=0;a<t;a++)for(i=0;i<n;i++)for(u[a*n+i]=0,f=0;f<o;f++)u[a*n+i]+=r[a*o+f]*e[f*n+i];return u}function i(r,e){var t,o,n,a=Array(e);for(t=0;t<e;t++)a[t]=r[t*e+t];for(t=0;t<e;t++){for(o=0;o<t;o++)a[t]-=r[t*e+o]*r[t*e+o];if(a[t]<=0)return!1;for(a[t]=Math.sqrt(a[t]),o=t+1;o<e;o++){for(n=0;n<t;n++)r[o*e+t]-=r[o*e+n]*r[t*e+n];r[o*e+t]/=a[t]}}for(t=0;t<e;t++)r[t*e+t]=a[t];return!0}function f(r,e){var t,o,n,a;for(t=0;t<e;t++)for(r[t*e+t]=1/r[t*e+t],o=t+1;o<e;o++){for(a=0,n=t;n<o;n++)a-=r[o*e+n]*r[n*e+t];r[o*e+t]=a/r[o*e+o]}for(t=0;t<e;t++)for(o=t+1;o<e;o++)r[t*e+o]=0;for(t=0;t<e;t++){for(r[t*e+t]*=r[t*e+t],n=t+1;n<e;n++)r[t*e+t]+=r[n*e+t]*r[n*e+t];for(o=t+1;o<e;o++)for(n=o;n<e;n++)r[t*e+o]+=r[n*e+t]*r[n*e+o]}for(t=0;t<e;t++)for(o=0;o<t;o++)r[t*e+o]=r[o*e+t]}function u(r,e){var t,o,n,a,i,f,u,s,l,p,c,h=e,g=Array(e*e),y=Array(e),m=Array(e),d=Array(e);for(t=0;t<e;t++)for(a=0;a<e;a++)g[t*e+a]=t==a?1:0;for(a=0;a<e;a++)d[a]=0;for(t=0;t<e;t++){for(s=0,a=0;a<e;a++)if(1!=d[a])for(i=0;i<e;i++)0==d[i]&&Math.abs(r[a*e+i])>=s&&(s=Math.abs(r[a*e+i]),n=a,o=i);if(++d[o],n!=o){for(f=0;f<e;f++)c=r[n*e+f],r[n*e+f]=r[o*e+f],r[o*e+f]=c;for(f=0;f<h;f++)c=g[n*e+f],g[n*e+f]=g[o*e+f],g[o*e+f]=c}if(m[t]=n,y[t]=o,0==r[o*e+o])return!1;for(p=1/r[o*e+o],r[o*e+o]=1,f=0;f<e;f++)r[o*e+f]*=p;for(f=0;f<h;f++)g[o*e+f]*=p;for(u=0;u<e;u++)if(u!=o){for(l=r[u*e+o],r[u*e+o]=0,f=0;f<e;f++)r[u*e+f]-=r[o*e+f]*l;for(f=0;f<h;f++)g[u*e+f]-=g[o*e+f]*l}}for(f=e-1;f>=0;f--)if(m[f]!=y[f])for(i=0;i<e;i++)c=r[i*e+m[f]],r[i*e+m[f]]=r[i*e+y[f]],r[i*e+y[f]]=c;return!0}function s(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*Math.pow(r/t,2)))}function l(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*(r/t)))}function p(r,e,t,o,n){return r>t?e+(o-e)/t:e+(o-e)/t*(r/t*1.5-.5*Math.pow(r/t,3))}t=t&&t.hasOwnProperty("default")?t.default:t,Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var r,e;for(r=0,e=0;r<this.length;r++)e+=this[r];return e/this.length},Array.prototype.rep=function(r){for(var e=new Array(r),t=this[0],o=0;o<r;o++)e[o]=t;return e},Array.prototype.pip=function(r,e){var t,o,n=!1;for(t=0,o=this.length-1;t<this.length;o=t++)this[t][1]>e!=this[o][1]>e&&r<(this[o][0]-this[t][0])*(e-this[t][1])/(this[o][1]-this[t][1])+this[t][0]&&(n=!n);return n};var c={};c.train=function(r,e,t,c,h,g){var y={t:r,x:e,y:t,nugget:0,range:0,sill:0,A:1/3,n:0};switch(c){case"gaussian":y.model=s;break;case"exponential":y.model=l;break;case"spherical":y.model=p}var m,d,M,v,A=r.length,w=Array((A*A-A)/2);for(m=0,M=0;m<A;m++)for(d=0;d<m;d++,M++)w[M]=Array(2),w[M][0]=Math.pow(Math.pow(e[m]-e[d],2)+Math.pow(t[m]-t[d],2),.5),w[M][1]=Math.abs(r[m]-r[d]);w.sort(function(r,e){return r[0]-e[0]}),y.range=w[(A*A-A)/2-1][0];var x=(A*A-A)/2>30?30:(A*A-A)/2,b=y.range/x,k=[0].rep(x),_=[0].rep(x);if(x<30)for(v=0;v<x;v++)k[v]=w[v][0],_[v]=w[v][1];else{for(m=0,d=0,M=0,v=0;m<x&&d<(A*A-A)/2;m++,M=0){for(;w[d][0]<=(m+1)*b&&(k[v]+=w[d][0],_[v]+=w[d][1],M++,!(++d>=(A*A-A)/2)););M>0&&(k[v]/=M,_[v]/=M,v++)}if(v<2)return y}A=v,y.range=k[A-1]-k[0];var P=[1].rep(2*A),q=Array(A),E=y.A;for(m=0;m<A;m++){switch(c){case"gaussian":P[2*m+1]=1-Math.exp(-1/E*Math.pow(k[m]/y.range,2));break;case"exponential":P[2*m+1]=1-Math.exp(-1/E*k[m]/y.range);break;case"spherical":P[2*m+1]=k[m]/y.range*1.5-.5*Math.pow(k[m]/y.range,3)}q[m]=_[m]}var j=function(r,e,t){var o,n,a=Array(t*e);for(o=0;o<e;o++)for(n=0;n<t;n++)a[n*e+o]=r[o*t+n];return a}(P,A,2),z=a(j,P,2,A,2),F=(z=n(z,o(1/g,2),2,2)).slice(0);i(z,2)?f(z,2):(u(F,2),z=F);var K=a(a(z,j,2,2,A),q,2,A,1);y.nugget=K[0],y.sill=K[1]*y.range+y.nugget,y.n=e.length,A=e.length;var O=Array(A*A);for(m=0;m<A;m++){for(d=0;d<m;d++)O[m*A+d]=y.model(Math.pow(Math.pow(e[m]-e[d],2)+Math.pow(t[m]-t[d],2),.5),y.nugget,y.range,y.sill,y.A),O[d*A+m]=O[m*A+d];O[m*A+m]=y.model(0,y.nugget,y.range,y.sill,y.A)}var C=n(O,o(h,A),A,A),B=C.slice(0);i(C,A)?f(C,A):(u(B,A),C=B);O=C.slice(0);var D=a(C,r,A,A,1);return y.K=O,y.M=D,y},c.predict=function(r,e,t){var o,n=Array(t.n);for(o=0;o<t.n;o++)n[o]=t.model(Math.pow(Math.pow(r-t.x[o],2)+Math.pow(e-t.y[o],2),.5),t.nugget,t.range,t.sill,t.A);return a(n,t.M,1,t.n,1)[0]},c.variance=function(r,e,t){var o,n=Array(t.n);for(o=0;o<t.n;o++)n[o]=t.model(Math.pow(Math.pow(r-t.x[o],2)+Math.pow(e-t.y[o],2),.5),t.nugget,t.range,t.sill,t.A);return t.model(0,t.nugget,t.range,t.sill,t.A)+a(a(n,t.K,1,t.n,t.n),n,1,t.n,1)[0]},c.grid=function(r,e,t,o){var n,a,i=[],f=[r[0],r[2]],u=[r[1],r[3]],s=1*(f[1]-f[0])/t,l=1*(u[1]-u[0])/o;for(let r=0;r<o;r++)for(let o=0;o<t;o++)n=f[0]+o*s,a=u[0]+r*l,i.push(c.predict(n,a,e));return{grid:i,n:t,m:o,xlim:f,ylim:u,zlim:[e.t.min(),e.t.max()],x_width:s,y_width:l}},c.contour=function(r,t){c.getAffineParams(r);let o=r.grid;var n=r.n,a=r.m,i=e.contours().size([n,a]).thresholds(t)(o);let f={type:"FeatureCollection",features:[]};return i.forEach(e=>{e.coordinates.forEach(t=>{let o=t.map(e=>{return e.map(function(e){return[r.xlim[0]+(r.xlim[1]-r.xlim[0])*(e[0]/n),r.ylim[0]+(r.ylim[1]-r.ylim[0])*(e[1]/a)]})});f.features.push({type:"Feature",properties:{level:e.value},geometry:{type:"Polygon",coordinates:o}})})}),f},r.kriging_contour=function(r,e,o,n,a){let i=[],f=[],u=[],s=[1e8,1e8,-1e8,-1e8];r.features.forEach(r=>{i.push(r.properties[e]),f.push(r.geometry.coordinates[0]),u.push(r.geometry.coordinates[1]),s[0]>r.geometry.coordinates[0]&&(s[0]=r.geometry.coordinates[0]),s[1]>r.geometry.coordinates[1]&&(s[1]=r.geometry.coordinates[1]),s[2]<r.geometry.coordinates[0]&&(s[2]=r.geometry.coordinates[0]),s[3]<r.geometry.coordinates[1]&&(s[3]=r.geometry.coordinates[1])});let l=c.train(i,f,u,o.model,o.sigma2,o.alpha),p=c.grid(s,l,200,200),h=c.contour(p,n);if(a){let r=h.features.map(r=>t(r,a));h.features=r}return h},Object.defineProperty(r,"__esModule",{value:!0})});
